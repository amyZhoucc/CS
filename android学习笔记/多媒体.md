# å¤šåª’ä½“

éœ€è¦ç”¨åˆ°çœŸæœºã€‚

é¦–å…ˆéœ€è¦å°†ç¨‹åºä¸‹è½½åˆ°æ‰‹æœºä¸Šï¼Œéœ€è¦å¯åŠ¨å¼€å‘è€…æ¨¡å¼â€”â€”ä¸åŒæ‰‹æœºçš„å¯åŠ¨æ–¹æ³•ä¸ä¸€æ ·ï¼šæœ‰çš„ç›´æ¥æœ‰è¿™ä¸ªé€‰é¡¹ï¼Œæœ‰çš„æ˜¯åœ¨å…³äºæœ¬æœºä¸Šç‚¹å‡»æŸä¸ªæ¡ç›®å¯åŠ¨çš„

## 1. é€šçŸ¥ğŸŒŸ

Android8.0ä¹‹å‰æ¯”è¾ƒç®€å•ï¼Œ8.0ä¹‹åéœ€è¦åˆ›å»º**é€šçŸ¥æ¸ é“**

é€šçŸ¥æ¸ é“ï¼šæ¯æ¡é€šçŸ¥éƒ½è¦å±äºä¸€ä¸ªå¯¹åº”çš„æ¸ é“ã€‚

æ¯ä¸ªåº”ç”¨ç¨‹åºéƒ½å¯ä»¥**è‡ªç”±åœ°åˆ›å»º**å½“å‰åº”ç”¨æ‹¥æœ‰å“ªäº›**é€šçŸ¥æ¸ é“**ï¼Œä½†æ˜¯è¿™äº›é€šçŸ¥æ¸ é“çš„**æ§åˆ¶æƒæ˜¯æŒæ¡åœ¨ç”¨æˆ·æ‰‹ä¸Šçš„**

â€”â€”èƒ½å¤Ÿè®©ç”¨æˆ·æ§åˆ¶é€šçŸ¥çš„æƒé™

egï¼šå¾®åšåˆ›å»ºä¸¤ä¸ªé€šçŸ¥æ¸ é“ï¼Œå…³æ³¨ã€æ¨èï¼Œæˆ‘å¯ä»¥é€‰æ‹©åªæ‰“å¼€å…³æ³¨æ¸ é“çš„é€šçŸ¥

åº”ç”¨ç¨‹åºåˆ›å»ºé€šçŸ¥æ¸ é“ä¹‹åä¸èƒ½å†ä¿®æ”¹äº†â€”â€”æ‰€ä»¥è¦å…ˆåˆ†æååˆ›å»ºã€‚

### 1.2 ä½¿ç”¨é€šçŸ¥

1. åˆ›å»ºnotificationManager

   ```kotlin
   val notifcationManager = getSystemService(Context.NOTIFICATION_SERVICE) as NotificationManager
   ```

2. åˆ›å»ºæ¸ é“

   å­˜åœ¨ç‰ˆæœ¬é—®é¢˜ï¼Œåœ¨Android 8.0ç³»ç»Ÿä»¥ä¸Šæ‰éœ€è¦åˆ›å»ºchannelï¼š

   å‚æ•°ï¼š

   1. æ¸ é“IDï¼šstringç±»å‹ï¼Œä¿è¯å…¨å±€å”¯ä¸€æ€§å³å¯ï¼ˆæ³¨æ„å’Œåé¢çš„notificationçš„å‚æ•°ä¿è¯ä¸€è‡´ï¼‰

   2. æ¸ é“åç§°ï¼šç»™ç”¨æˆ·çœ‹çš„

   3. é‡è¦ç­‰çº§

      NotificationManager.IMPORTANCE_HIGHã€.IMPORTANCE_DEFAULTã€.IMPORTANCE_LOWã€.IMPORTANCE_MIN

   ```kotlin
   if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O){
     val channel = NotificationChannel("normal", "app", NotificationManager.IMPORTANCE_DEFAULT)
     notifcationManager.createNotificationChannel(channel)
   }
   ```

3. åˆ›å»ºnotificationå¯¹è±¡ï¼šä½¿ç”¨ä¸€ä¸ªBuilderæ„é€ å™¨æ¥

   ä¸ºäº†å®ç°é€‚é…ï¼šä½¿ç”¨AndroidXåº“çš„NotificationCompatç±»

   builderéœ€è¦ä¸¤ä¸ªå‚æ•°ï¼š

   1. ç¬¬ä¸€ä¸ªå‚æ•°ï¼šcontext
   2. ç¬¬äºŒä¸ªå‚æ•°ï¼šæ¸ é“IDï¼Œæ³¨æ„å’Œä¸Šé¢çš„channelIdä¸€è‡´

   build()æ–¹æ³•ä¹‹å‰è¿ç¼€ä»»æ„å¤šçš„è®¾ç½®æ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ªä¸°å¯Œçš„Notificationå¯¹è±¡

   ```kotlin
   val notifcation = NotificationCompat.Builder(this, "normal")
   										.setContentTitle("this is title")
   										.setContentText("this is content")
   										.setSmallIcon(R.mipmap.ic_launcher)
   										.setLargeIcon(BitmapFactory.decodeResource(resources, 												R.drawable.ic_launcher_foreground))
   										.build()
   ```

4. ä½¿ç”¨

   å‚æ•°ï¼š

   1. idï¼šä¿è¯è¯¥é€šçŸ¥çš„idæ˜¯å”¯ä¸€çš„
   2. notificationå¯¹è±¡

   ```kotlin
   notifcationManager.notify(1,notifcation)
   ```

 ä½†æ˜¯ï¼Œç›®å‰çš„å¹¿æ’­å†…å®¹ç‚¹å‡»æ˜¯æ²¡æœ‰ä»»ä½•å“åº”çš„â€”â€”æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªæŒ‰é’®ï¼Œæ‰€ä»¥éœ€è¦æœ‰å¯¹åº”çš„äº‹ä»¶ã€‚

â€”â€”PendingIntentï¼šç®—æ˜¯å»¶è¿Ÿæ‰§è¡Œçš„intentã€‚

PendingIntentçš„å®ä¾‹ï¼Œå¯ä»¥æ ¹æ®éœ€æ±‚æ¥é€‰æ‹©æ˜¯ä½¿ç”¨getActivity()æ–¹æ³•ã€getBroadcast()æ–¹æ³•ï¼Œè¿˜æ˜¯getService()æ–¹æ³•ã€‚

éœ€è¦4ä¸ªå‚æ•°ï¼š

1. Context
2. ä¼ å…¥0å³å¯
3. Intentå¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªå¯¹è±¡æ„å»ºå‡ºPendingIntentçš„â€œæ„å›¾â€
4. PendingIntentçš„è¡Œä¸ºï¼Œä¸€èˆ¬ä¼ 0

egï¼š

```kotlin
val intent = Intent(this, NotificationActivity::class.java)		// åˆ›å»ºintent
val pi = PendingIntent.getActivity(this, 0, intent, 0)
```

NotificationCompat.Builderã€‚è¿™ä¸ªæ„é€ å™¨è¿˜å¯ä»¥è¿ç¼€ä¸€ä¸ª**setContentIntent()**æ–¹æ³•ï¼Œæ¥æ”¶çš„å‚æ•°æ­£æ˜¯ä¸€ä¸ªPendingIntentå¯¹è±¡ã€‚

```kotlin
.setContentIntent(pi)
```

â€”â€”è¿™æ ·ç‚¹å‡»è¯¥é€šçŸ¥å°±èƒ½è·³è½¬åˆ°NotificationActivityè¿™ä¸ªæ´»åŠ¨ä¸­äº†

ä¼˜åŒ–ï¼šä»é€»è¾‘ä¸Šè®²ï¼Œç‚¹å‡»äº†é€šçŸ¥ï¼Œç³»ç»ŸçŠ¶æ€ä¸Šçš„é€šçŸ¥å›¾æ ‡åº”è¯¥æ¶ˆå¤±ï¼š

å¯ä»¥ä½¿ç”¨ï¼š

1. Builderä¸­ä¸²è”ä¸€ä¸ª

   ```kotlin
   .setAutoCancel(true)
   ```

2. åœ¨è·³è½¬çš„æ´»åŠ¨ä¸­å°†è¯¥notificationå–æ¶ˆ

   ```kotlin
   // å°±æ˜¯è·å¾—è¯¥notificationmanagerå¯¹è±¡â€”â€”åŒä¸Šé¢
   val manager = getSystemService(Context.NOTIFICATION_SERVICE) as NotificationManager
   manager.cancel(1)			//  é€šçŸ¥çš„id
   ```

### psï¼šnotificationçš„è¿›é˜¶æŠ€å·§

ä¸»è¦æ˜¯NotificationCompact.Builder()å¯ä»¥è¿ç¼€æ›´å¤šçš„æ–¹æ³•ï¼š

#### 1. setStyle()

æ„å»ºå‡ºå¯Œæ–‡æœ¬çš„é€šçŸ¥å†…å®¹ã€‚

å‚æ•°ï¼šæ¥æ”¶ä¸€ä¸ªNotificationCompat.Styleå‚æ•°

egï¼šå¯¹äºé•¿æ–‡æœ¬ï¼Œé€šçŸ¥ä¸ä¼šå®Œå…¨æ˜¾ç¤ºï¼Œè€Œå¤šä½™çš„éƒ¨åˆ†ä¼šç”¨çœç•¥å·ä»£æ›¿

```kotlin
.setStyle(NotificationCompat.BigTextStyle().bigText(....)
```

egï¼šå¯¹äºå¤§å›¾ç‰‡å¯ä»¥ç±»ä¼¼å®ç°

```kotlin
.setStyle(NotificationCompat.BigPictureStyle().bigPicture(BitmapFactory.decodeResource(resources, R.drawable.ic_launcher_foreground)))
```

#### 2. é‡è¦ç­‰çº§

é«˜é‡è¦ç­‰çº§çš„é€šçŸ¥æ¸ é“å‘å‡ºçš„é€šçŸ¥å¯ä»¥å¼¹å‡ºæ¨ªå¹…ã€å‘å‡ºå£°éŸ³ï¼Œè€Œä½é‡è¦ç­‰çº§çš„é€šçŸ¥æ¸ é“å‘å‡ºçš„é€šçŸ¥ä¸ä»…å¯èƒ½ä¼šåœ¨æŸäº›æƒ…å†µä¸‹è¢«éšè—ï¼Œè€Œä¸”å¯èƒ½ä¼šè¢«æ”¹å˜æ˜¾ç¤ºçš„é¡ºåºï¼Œå°†å…¶æ’åœ¨æ›´é‡è¦çš„é€šçŸ¥ä¹‹åã€‚

æ³¨æ„ï¼šå¼€å‘è€…åªèƒ½åœ¨åˆ›å»ºé€šçŸ¥æ¸ é“çš„æ—¶å€™ä¸º**å®ƒæŒ‡å®šåˆå§‹çš„é‡è¦ç­‰çº§**ï¼Œå¦‚æœç”¨æˆ·ä¸è®¤å¯è¿™ä¸ªé‡è¦ç­‰çº§çš„è¯ï¼Œå¯ä»¥éšæ—¶è¿›è¡Œä¿®æ”¹ï¼Œ**å¼€å‘è€…å¯¹æ­¤æ— æƒå†è¿›è¡Œè°ƒæ•´å’Œå˜æ›´**ï¼Œå› ä¸ºé€šçŸ¥æ¸ é“ä¸€æ—¦åˆ›å»ºå°±ä¸èƒ½å†é€šè¿‡ä»£ç ä¿®æ”¹äº†ã€‚

```
NotificationManager.IMPORTANCE_DEFAULT
```

## 2. æ‘„åƒå¤´å’Œç›¸å†Œ

```kotlin
class NotificationActivity : AppCompatActivity() {
    val takePhoto = 1
    lateinit var imageUri : Uri             // æ‹ç…§å›¾ç‰‡çš„å…·ä½“çš„ä½ç½®
    lateinit var outputImage : File         // å›¾ç‰‡æ–‡ä»¶
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_notification)

        val imageButton : Button = findViewById(R.id.phototBtn)
        imageButton.setOnClickListener {
        		// åˆ›å»ºfileå¯¹è±¡ï¼Œç”¨æ¥å­˜æ”¾å›¾ç‰‡
        		// å­˜æ”¾çš„ä½ç½®åœ¨åº”ç”¨å…³è”ç¼“å­˜ç›®å½•ä¸‹â€”â€”getexternalCacheDir()
            outputImage = File(externalCacheDir, "output_img,jpg")
            if(outputImage.exists()){			// åˆ¤æ–­è¯¥fileå¯¹è±¡æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨å°±åˆ é™¤
                outputImage.delete()
            }
            outputImage.createNewFile()		// åˆ›å»ºæ–°æ–‡ä»¶æ¥å­˜å‚¨
            // åˆ¤æ–­ç‰ˆæœ¬>7.0ï¼Œåˆ™è°ƒç”¨ç‰¹æ®Šçš„ContentProviderï¼Œè¿›è¡Œä¿æŠ¤
            imageUri = if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.N){
                FileProvider.getUriForFile(this, "com.example.broadcasttest.fileProvider", outputImage)
            }else{// å°äº7.0ï¼Œå°†fileå¯¹å¯¹è±¡å˜æˆuriå¯¹è±¡â€”â€”å­˜å‚¨ç€æœ¬åœ°çœŸå®è·¯å¾„
                Uri.fromFile(outputImage)
            }
            // éšå¼çš„intentï¼Œè€Œç›¸æœºè¿™ä¸ªactivityä¼šå“åº”è¯¥intent
            val intent = Intent("android.media.action.IMAGE_CAPTURE")
            intent.putExtra(MediaStore.EXTRA_OUTPUT, imageUri)
            startActivityForResult(intent, takePhoto)
        }
    }

    override fun onActivityResult(requestCode: Int, resultCode: Int, data: Intent?) {
        super.onActivityResult(requestCode, resultCode, data)
        // å›è°ƒ
        when(requestCode){
            takePhoto ->{
                if(resultCode == Activity.RESULT_OK){
                    val bitmap = BitmapFactory.decodeStream(contentResolver.openInputStream(imageUri))
                    val imageView : ImageView = findViewById(R.id.imageShow)
                    imageView.setImageBitmap(bitmap)
                }
            }
        }
    }
}
```

å› ä¸ºè°ƒç”¨ç‰¹æ®Šçš„ContentProviderï¼Œæ‰€ä»¥éœ€è¦è¿›è¡Œæ³¨å†Œï¼š

```xml
<application
	...>
        <provider
            android:authorities="com.example.broadcasttest.fileProvider"
            android:name="androidx.core.content.FileProvider"
            android:exported="false"
            android:grantUriPermissions="true">
            <meta-data android:name="android.support.FILE_PROVIDER_PATHS"
                android:resource="@xml/file_paths" />
        </provider>
  
  // åœ¨xmlæ–‡ä»¶å¤¹ä¸‹æ–°å»ºfile_paths.xmlæ–‡ä»¶â€”â€”æŒ‡å®šå…±äº«è·¯å¾„
  <paths xmlns:android="http://schemas.android.com/apk/res/android">
    <external-path
        name="my_images"
        path="/"/>
</paths>
```

æ‰“å¼€å›¾ç‰‡ä¹Ÿæ˜¯ç±»ä¼¼çš„æ“ä½œï¼š

```kotlin
val selectBtn : Button = findViewById(R.id.albumBtn)
selectBtn.setOnClickListener {
  val intent = Intent(Intent.ACTION_OPEN_DOCUMENT)
  intent.addCategory(Intent.CATEGORY_OPENABLE)
  intent.type = "image/ *"
  startActivityForResult(intent, fromAlbum)
}

override fun onActivityResult(requestCode: Int, resultCode: Int, data: Intent?) {
  super.onActivityResult(requestCode, resultCode, data)
  when(requestCode){
    takePhoto ->{
      if(resultCode == Activity.RESULT_OK){
        val bitmap = BitmapFactory.decodeStream(contentResolver.openInputStream(imageUri))
        val imageView : ImageView = findViewById(R.id.imageShow)
        imageView.setImageBitmap(bitmap)
      }
    }
    fromAlbum ->{
      if(resultCode == Activity.RESULT_OK && data != null) {
        data.data?.let { uri ->
                        val bitmap = getBitmapFromUri(uri)
                        Log.d("album", "data")
                        val imageView : ImageView = findViewById(R.id.imageShow)
                        imageView.setImageBitmap(bitmap)
                       }
      }
    }
  }
}
private fun getBitmapFromUri(uri : Uri) = contentResolver.openFileDescriptor(uri, "r")?.use {
  BitmapFactory.decodeFileDescriptor(it.fileDescriptor)
}
```

## 3. æ’­æ”¾è§†é¢‘/éŸ³é¢‘

å¯¹äºå¤šåª’ä½“éƒ½æ˜¯ç”¨MediaPlayeræ¥å®ç°çš„ï¼Œ

MediaPlayerçš„å·¥ä½œæµç¨‹ï¼š

1. è°ƒç”¨ï¼š**setDataSource()**ï¼Œè®¾ç½®éŸ³é¢‘æ–‡ä»¶çš„è·¯å¾„
2. è°ƒç”¨ï¼šprepare()æ–¹æ³•ï¼Œè¿›å…¥å‡†å¤‡çŠ¶æ€
3. è°ƒç”¨ï¼šstart()æ–¹æ³•å°±å¯ä»¥å¼€å§‹æ’­æ”¾éŸ³é¢‘
4. è°ƒç”¨ï¼špause()æ–¹æ³•å°±ä¼šæš‚åœæ’­æ”¾
5. è°ƒç”¨ï¼šreset()æ–¹æ³•ä¼šåœæ­¢æ’­æ”¾
6. è°ƒç”¨ï¼šstop()æ–¹æ³•ä¼šåœæ­¢æ’­æ”¾ï¼Œä¸”è¯¥å¯¹è±¡æ— æ³•å†æ’­æ”¾äº†ï¼Œä¹‹åä¸€èˆ¬é©¬ä¸Šè°ƒç”¨releaseï¼Œå»é‡Šæ”¾è¯¥èµ„æº

```kotlin
class MediaActivity : AppCompatActivity() {
    private val mediaPlayer = MediaPlayer()
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_media)
        val play : Button = findViewById(R.id.play)
        val pause : Button = findViewById(R.id.pause)
        val stop : Button = findViewById(R.id.stop)
        play.setOnClickListener {
            if(!mediaPlayer.isPlaying){
                mediaPlayer.start()
            }
        }
        pause.setOnClickListener{
            if(mediaPlayer.isPlaying){
                mediaPlayer.pause()
            }
        }
      	stop.setOnClickListener{
            if(mediaPlayer.isPlaying){
                mediaPlayer.reset()
            }
        }
    }
  	// åˆå§‹åŒ–æ’­æ”¾å™¨
    private fun initMediaPlayer(){
        val assetManager = assets           // è·å–å¯¹åº”çš„æ–‡ä»¶å¤¹
        val fd = assetManager.openFd("")		// æ‰“å¼€å¯¹åº”çš„æ–‡ä»¶
      	// è·å–å¯¹åº”çš„èµ„æº
        mediaPlayer.setDataSource(fd.fileDescriptor, fd.startOffset, fd.length)
        mediaPlayer.prepare()
    }
		
  // åœ¨activityé”€æ¯çš„æ—¶å€™ï¼Œå°†å¯¹åº”çš„èµ„æºé‡Šæ”¾
    override fun onDestroy() {
        super.onDestroy()
        mediaPlayer.stop()
        mediaPlayer.release()
    }
}
```

è§†é¢‘ç±»ä¼¼ï¼Œåªä¸è¿‡ä½¿ç”¨çš„æ˜¯**VideoViewç±»**