# 装饰者模式

## 定义

装饰者模式：动态地将责任附加到对象上，如果扩展很多，且不确定，装饰者比继承更有弹性

<img src="C:\Users\surface\AppData\Roaming\Typora\typora-user-images\image-20220324170323992.png" alt="image-20220324170323992" style="zoom:70%;" />

这边的继承是为了类型匹配，而不是为了获得行为

## 设计原则5

类应该对扩展开放，对修改关闭

## eg

咖啡店的订单系统设计

第一版设计：一个超类，有默认的实例变量和对应的方法

<img src="C:\Users\surface\AppData\Roaming\Typora\typora-user-images\image-20220324164146820.png" alt="image-20220324164146820" style="zoom:50%;" />

问题是：用户的需求多变，可能需要双份的牛奶；原材料价格改变，cost的计算方式变化；出现新饮料，例如茶，不适合加入的配料由于继承依然存在。

——以饮料为主体，运行时

思路：

1. 咖啡为主体对象
2. 牛奶装饰
3. 糖水装饰
4. 调用cost方法，**依赖委托将价格加上去**

<img src="C:\Users\surface\AppData\Roaming\Typora\typora-user-images\image-20220324165727020.png" alt="image-20220324165727020" style="zoom:67%;" />

**主体类和装饰类都是继承自同一个超类**

1. 特定的方法可以不断的委托出去
2. 在任何需要原始对象的地方，都可以用包装过的对象代替
3. **装饰者在所委托被装饰者的行为之前或者之后，加上自己的行为，就成功包装了**

实现：

超类：

```java
public abstract class Beverage{
    String description = "Unknown Beverage";
    
    public String getDescription(){
        return description;
    }
    public abstract double cost();
    
}
```

调料的装饰者类：

```java
public abstract class CondimentDecorator extends Beverage{
    public abstract String getDescription();
}
```

饮料主体：

```java
public class Espresso extends Beverage{
    public Espresso(){
        description = "Espresso";
    }
    public double cost(){
        return 0.9;
    }
}
```

具体装饰者（调料）

```java
public class Mocha extends CondimentDecorator{
    Beverage beverage;
    
    public Mocha(Beverage beverage){		// 获取装饰者需要装饰的对象
        this.beverage = beverage;
    }
    public String getDescription(){
        return beverage.getDescription() + ", Mocha";
    }
    public double cost(){
        return beverage.cost() + 0.1;
    }
    
}
```

使用：

```java
public class Order{
    public static void main(String[] args){
        Beverage beverage = new Espresso();
        Beverage beverage2 = new Mocha(beverage);
        Beverage beverage3 = new Mocha(beverage2);
        Beverage beverage4 = new Milk(beverage3);
    }
}
```

## eg2

Java I/O

<img src="C:\Users\surface\AppData\Roaming\Typora\typora-user-images\image-20220324172419706.png" alt="image-20220324172419706" style="zoom:50%;" />

主体类型有：`FileInputStream`，`StringBufferInputStream`，`ByteArrayInputStream`

修饰类型有：`BufferedInputStream`（缓冲输入提高性能），`LineNumberInputStream`（计算行数的能力）

<img src="C:\Users\surface\AppData\Roaming\Typora\typora-user-images\image-20220324184933659.png" alt="image-20220324184933659" style="zoom:50%;" />

缺点：**利用装饰者模式，会造成有大量的小类，数量太多**

